{# 
 # Template de gestion des jeux vidéo
 #
 # Fonctionnalités :
 # - Affichage de la liste complète des jeux
 # - Ajout d'un nouveau jeu
 # - Modification des informations d'un jeu
 # - Suppression d'un jeu
 # - Gestion des associations (genre, marque, plateforme, PEGI)
 #}
{% extends "base.html.twig" %}

{% block central %}
    <div class="col-sm-12">
        <section class="panel">
            {# En-tête du panneau #}
            <div class="chat-room-head">
                <h3><i class="fa fa-gamepad"></i> Gérer les jeux</h3>
            </div>

            <div class="panel-body">
                {# Tableau des jeux #}
                <table class="table table-striped table-advance table-hover">
                <thead>
                    <tr class="tableau-entete">
                        <th><i class="fa fa-barcode"></i> Réf.</th>
                        <th><i class="fa fa-bookmark"></i> Nom</th>
                        <th><i class="fa fa-eur"></i> Prix</th>
                        <th><i class="fa fa-calendar"></i> Parution</th>
                        <th><i class="fa-solid fa-marker"></i>Genre</th>
                        <th><i class="fa-solid fa-signature"></i>Marque</th>
                        <th><i class="fa-brands fa-xbox"></i>Plateforme</th>
                        <th><i class="fa-solid fa-1"></i>PEGI</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {# Formulaire d'ajout d'un nouveau jeu #}
                    <tr>
                        <form action="index.php?uc=gererJeux" method="post">
                            {# Référence du jeu #}
                            <td>
                                <input type="text" 
                                       name="refJeu" 
                                       size="10" 
                                       required 
                                       placeholder="Référence">
                            </td>

                            {# Nom du jeu #}
                            <td>
                                <input type="text" 
                                       name="nom" 
                                       size="20" 
                                       required 
                                       placeholder="Nom du jeu">
                            </td>

                            {# Prix du jeu #}
                            <td>
                                <input type="number" 
                                       name="prix" 
                                       step="0.01" 
                                       style="width:80px;" 
                                       required 
                                       placeholder="Prix">
                            </td>

                            {# Date de parution #}
                            <td>
                                <input type="date" 
                                       name="dateParution" 
                                       style="width:130px;" 
                                       required>
                            </td>

                            {# Sélection du genre #}
                            <td>
                                <select name="idGenre">
                                    {% for genre in tbGenres %}
                                        <option value="{{ genre.identifiant }}">
                                            {{ genre.libelle }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </td>
                            {# Sélection de la marque #}
                            <td>
                                <select name="idMarque">
                                    {% for marque in tbMarques %}
                                        <option value="{{ marque.identifiant }}">
                                            {{ marque.libelle }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </td>

                            {# Sélection de la plateforme #}
                            <td>
                                <select name="idPlateforme">
                                    {% for plateforme in tbPlateformes %}
                                        <option value="{{ plateforme.identifiant }}">
                                            {{ plateforme.libelle }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </td>

                            {# Sélection du PEGI #}
                            <td>
                                <select name="idPegi">
                                    {% for pegi in tbPegis %}
                                        <option value="{{ pegi.identifiant }}">
                                            {{ pegi.age }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </td>

                            {# Boutons d'action #}
                            <td>
                                <button class="btn btn-primary btn-xs" 
                                        type="submit" 
                                        name="cmdAction" 
                                        value="ajouterNouveauJeu" 
                                        title="Enregistrer nouveau jeu">
                                    <i class="fa fa-save"></i>
                                </button>
                                <button class="btn btn-info btn-xs" 
                                        type="reset" 
                                        title="Effacer la saisie">
                                    <i class="fa fa-eraser"></i>
                                </button>
                            </td>
                        </form>
                    </tr>
                    {% for jeu in tbJeux %}
                        <tr>
                            <form action="index.php?uc=gererJeux" method="post" style="display: contents;">
                                <input type="hidden" name="refJeu" value="{{ jeu.refJeu|e }}">
                                {# Mode édition d'un jeu existant #}
                                {% if refJeuModif is defined and jeu.refJeu == refJeuModif %}
                                    {# Référence du jeu (en lecture seule) #}
                                    <td>{{ jeu.refJeu|e }}</td>

                                    {# Champ de modification du nom #}
                                    <td>
                                        <input type="text" 
                                               name="nom" 
                                               value="{{ jeu.nom|e }}" 
                                               size="20" 
                                               required>
                                    </td>

                                    {# Champ de modification du prix #}
                                    <td>
                                        <input type="number" 
                                               name="prix" 
                                               step="0.01" 
                                               value="{{ jeu.prix|e }}" 
                                               style="width:80px;" 
                                               required>
                                    </td>

                                    {# Champ de modification de la date de parution #}
                                    <td>
                                        <input type="date" 
                                               name="dateParution" 
                                               value="{{ jeu.dateParution|e }}" 
                                               style="width:130px;" 
                                               required>
                                    </td>

                                    {# Liste déroulante des genres #}
                                    <td>
                                        <select name="idGenre">
                                            {% for genre in tbGenres %}
                                                {% set selected = (jeu.libGenre == genre.libelle) ? 'selected' : '' %}
                                                <option value="{{ genre.identifiant }}" {{ selected }}>
                                                    {{ genre.libelle }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </td>

                                    {# Liste déroulante des marques #}
                                    <td>
                                        <select name="idMarque">
                                            {% for marque in tbMarques %}
                                                {% set selected = (jeu.nomMarque == marque.libelle) ? 'selected' : '' %}
                                                <option value="{{ marque.identifiant }}" {{ selected }}>
                                                    {{ marque.libelle }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </td>

                                    {# Liste déroulante des plateformes #}
                                    <td>
                                        <select name="idPlateforme">
                                            {% for plateforme in tbPlateformes %}
                                                {% set selected = (jeu.libPlateforme == plateforme.libelle) ? 'selected' : '' %}
                                                <option value="{{ plateforme.identifiant }}" {{ selected }}>
                                                    {{ plateforme.libelle }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </td>

                                    {# Liste déroulante des PEGI #}
                                    <td>
                                        <select name="idPegi">
                                            {% for pegi in tbPegis %}
                                                {% set selected = (jeu.ageLimite == pegi.age) ? 'selected' : '' %}
                                                <option value="{{ pegi.identifiant }}" {{ selected }}>
                                                    {{ pegi.age }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </td>

                                    {# Boutons d'action pour la modification #}
                                    <td>
                                        <button class="btn btn-primary btn-xs" 
                                                type="submit" 
                                                name="cmdAction" 
                                                value="validerModifierJeu" 
                                                title="Enregistrer">
                                            <i class="fa fa-save"></i>
                                        </button>
                                        <button class="btn btn-warning btn-xs" 
                                                type="submit" 
                                                name="cmdAction" 
                                                value="annulerModifierJeu" 
                                                title="Annuler">
                                            <i class="fa fa-undo"></i>
                                        </button>
                                    </td>
                                {# Mode affichage normal d'un jeu #}
                                {% else %}
                                    {# Affichage de la référence #}
                                    <td>{{ jeu.refJeu|e }}</td>

                                    {# Affichage du nom #}
                                    <td>{{ jeu.nom|e }}</td>

                                    {# Affichage du prix #}
                                    <td>{{ jeu.prix|e }} €</td>

                                    {# Affichage de la date de parution #}
                                    <td>{{ jeu.dateParution|date('d/m/Y') }}</td>

                                    {# Affichage du genre #}
                                    <td>{{ jeu.libGenre|e }}</td>

                                    {# Affichage de la marque #}
                                    <td>{{ jeu.nomMarque|e }}</td>

                                    {# Affichage de la plateforme #}
                                    <td>{{ jeu.libPlateforme|e }}</td>

                                    {# Affichage de l'âge PEGI #}
                                    <td>{{ jeu.ageLimite|e }}</td>

                                    {# Boutons d'action #}
                                    <td>
                                        {# Affichage de la notification si présente #}
                                        {% if notification != 'rien' and jeu.refJeu == refJeuNotif %}
                                            <button class="btn btn-success btn-xs">
                                                <i class="fa fa-check"></i> {{ notification }}
                                            </button>
                                        {% endif %}

                                        {# Bouton de modification #}
                                        <button class="btn btn-primary btn-xs" 
                                                type="submit" 
                                                name="cmdAction" 
                                                value="demanderModifierJeu" 
                                                title="Modifier">
                                            <i class="fa fa-pencil"></i>
                                        </button>

                                        {# Bouton de suppression #}
                                        <button class="btn btn-danger btn-xs" 
                                                type="submit" 
                                                name="cmdAction" 
                                                value="supprimerJeu" 
                                                title="Supprimer" 
                                                onclick="return confirm('Voulez-vous vraiment supprimer ce jeu ?');">
                                            <i class="fa fa-trash-o"></i>
                                        </button>
                                    </td>
                                {% endif %}
                            </form>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}


